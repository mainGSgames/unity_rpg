<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: 'en-us', environment_currency: undefined }});</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Troubleshooting Scriptable Render Passes with HDR Output in URP</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="author" content="Unity Technologies">
<meta property="relative-path-to-manual" content="../../">
<meta property="version-switcher-versions-with-this-page" content="Versions with this page:">
<meta property="version-switcher-versions-without-this-page" content="Versions without this page:">
<meta property="version-switcher-supported" content="Supported">
<meta property="version-switcher-legacy" content="Legacy">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../../../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../../../StaticFilesManual/images/favicons/apple-touch-icon.png">
<link rel="canonical" href="https://docs.unity3d.com/6000.2/Documentation/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../../../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="/StaticFilesConfig/UnityVersionsInfo.js"></script><script type="text/javascript" src="../../../StaticFilesManual/js/jquery.js?ts=20250905"></script><script type="text/javascript" src="../../../StaticFilesManual/js/core.js?ts=20250905"></script><script type="text/javascript" src="../../../StaticFilesManual/js/image-comp.js?ts=20250905"></script><script type="text/javascript" src="../../docdata/toc.js?ts=20250905"></script><script type="text/javascript" src="../../docdata/global_toc.js?ts=20250905"></script><link rel="stylesheet" type="text/css" href="../../../StaticFilesManual/css/core.css?ts=20250905">
<link rel="stylesheet" type="text/css" href="../../../StaticFilesManual/css/icons.css?ts=20250905">
<link rel="stylesheet" href="../../../StaticFilesManual/css/prism.css">
<script src="../../../StaticFilesManual/js/prism.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><script src="../../../StaticFilesManual/js/jquery.sidebar.min.js"></script><link rel="stylesheet" href="../../../StaticFilesManual/css/mobileoptimisation.css">
<script src="../../../StaticFilesManual/js/mobileoptimisation.js"></script>
</head>
<body>
<div id="DocsAnalyticsData" data-area="none" data-pagetype="manual"></div>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a aria-label="go to the homepage" href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="../../30_search.html" method="get" class="apisearch">
<input type="text" name="q" aria-label="Search manual documentation" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../../index.html" class="selected">Manual</a></li>
<li><a href="../../../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity.com/">unity.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>Unity 6.2</b> (6000.2)
                                <div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">
<ul id="OtherVersionsContentUl"></ul>
<div id="otherVersionsLegend"><ul>
<li>
<div id="supportedColour" class="legendBox"></div>Supported</li>
<li>
<div id="notFoundColour" class="legendBox"></div>Legacy</li>
</ul></div>
</div>
<div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div>
</div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">English</a></li>
<li><a href="/cn/current/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">中文</a></li>
<li><a href="/ja/current/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">日本語</a></li>
<li><a href="/kr/current/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">한국어</a></li>
</ul></div>
</div></div>
</div></div>
<div class="mobileLogo"><a aria-label="go to the homepage" href="https://docs.unity3d.com"></a></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc" id="customScrollbar">
<h2>Unity Manual</h2>
<div class="search-form sidebar-search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" aria-label="Search manual documentation" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" id="mobileSearchBtn" class="submit" value="Search">
</form></div>
<div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent"><form id="otherVersionsContentMobileForm"><div class="ui-field-contain">
<label for="select-native-4">Version: Unity 6.2</label><select name="select-native-4" id="versionsSelectMobile"><option>Select a different version</option>
<optgroup id="versionsWithThisPageMobile" label="Versions with this page"></optgroup>
<optgroup id="versionsWithoutThisPageMobile" label="Versions without this page"></optgroup></select>
</div></form></div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">English</a></li>
<li><a href="/cn/current/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">中文</a></li>
<li><a href="/ja/current/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">日本語</a></li>
<li><a href="/kr/current/Manual/urp/post-processing/troubleshoot-hdr-custom-pass.html">한국어</a></li>
</ul></div>
</div></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="../../materials-and-shaders.html">Materials and shaders</a></li>
<li><a href="../../graphics-color.html">Color and High Dynamic Range (HDR)</a></li>
<li><a href="../../hdr-landing.html">High dynamic range (HDR)</a></li>
<li><a href="../../urp/post-processing/hdr-in-urp.html">HDR</a></li>
<li>Troubleshooting Scriptable Render Passes with HDR Output in URP</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a aria-label="go to the previous page" href="../../urp/post-processing/hdr-output-implement-custom-overlay.html"></a></span><div class="tip">Implement an HDR Output compatible custom overlay in URP</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a aria-label="go to the next page" href="../../class-ShaderImporter.html"></a></span><div class="tip">Shader Import Settings window reference</div>
</div>
</div></div>
<div id="_leavefeedback"></div>
<h1>Troubleshooting Scriptable Render Passes with HDR Output in URP</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>High Dynamic Range (HDR) Output changes the inputs to your scriptable render pass when it applies tone mapping and color space conversions. These changes can cause your scriptable render pass to produce incorrect results. This means that when you use <span class="tooltip"><strong>HDR</strong><span class="tooltiptext">high dynamic range<br/><span class="tooltipGlossaryLink">See in <a href="../../Glossary.html#HDR">Glossary</a></span></span></span> Output and a scriptable render pass that happens in or after the AfterRenderingPostProcessing injection point, you need to account for the changes HDR Output makes. This also applies when you want to add overlays during or after <span class="tooltip"><strong>post-processing</strong><span class="tooltiptext">A process that improves product visuals by applying filters and effects before the image appears on screen. You can use post-processing effects to simulate physical camera and film properties, for example Bloom and Depth of Field. <a class="tooltipMoreInfoLink" href="../../PostProcessingOverview.html">More info</a> <span class="search-words">post processing, postprocessing, postprocess</span><br/><span class="tooltipGlossaryLink">See in <a href="../../Glossary.html#post-processing">Glossary</a></span></span></span>, such as UI or output from other <span class="tooltip"><strong>cameras</strong><span class="tooltiptext">A component which creates an image of a particular viewpoint in your scene. The output is either drawn to the screen or captured as a texture. <a class="tooltipMoreInfoLink" href="../../CamerasOverview.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="../../Glossary.html#Camera">Glossary</a></span></span></span>, because you need to work with the color gamut that results from HDR Output. To make a scriptable render pass work with the changes HDR Output makes, you must manually perform <a href="#tone-map-convert-color-space">tone mapping and convert color space in a script</a>.</p>

<p>However, if you add your scriptable render pass at or before the BeforeRenderingPostProcessing injection point, you don’t need to make any changes for compatibility with HDR Output. This is because Unity executes your scriptable render pass before it renders the HDR Output.</p>

<p>
<strong>Note</strong>: You can avoid this problem when you use a camera stack to render camera output before Unity performs tone mapping. Unity then applies HDR Output processing to the last camera in the stack. To learn how to set up a camera stack, refer to <a href="../camera-stacking.html">Camera stacking</a>.</p>

<h2>
<a name="tone-map-convert-color-space" aria-hidden="true"></a>Tone map and convert color space in a script</h2>

<p>To make a scriptable render pass pass work with the changes HDR Output makes to color space and dynamic range, use the <code>SetupHDROutput</code> function to apply tone mapping and color space conversion to the material the scriptable render pass alters:</p>

<ol>
<li><p>Open the C# script which contains the Scriptable Render Pass you wish to use with HDR Output.</p></li>
<li>
<p>Add a method with the name <code>SetupHDROutput</code> to the Render Pass class.</p>

<p>The following script gives an example of how to use the <code>SetupHDROutput</code> function:</p>

<pre><code class="lang-cs">class CustomFullScreenRenderPass : ScriptableRenderPass
{
    // Leave your existing Render Pass code here

    static void SetupHDROutput(ref CameraData cameraData, Material material)
    {
        // This is where most HDR related code is added
    }
}
</code></pre>
</li>
<li>
<p>Add an <code>if</code> statement to check whether HDR Output is active and if the camera has post-processing enabled. If either condition is not met, disable the HDR Output <span class="tooltip"><strong>shader</strong><span class="tooltiptext">A program that runs on the GPU. <a class="tooltipMoreInfoLink" href="../../Shaders.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="../../Glossary.html#Shader">Glossary</a></span></span></span> keywords to reduce resource usage.</p>

<pre><code class="lang-cs">static void SetupHDROutput(ref CameraData cameraData, Material material)
{
    // If post processing is enabled, color grading has already applied tone mapping
    // As a result the input here will be in the display colorspace (Rec2020, P3, etc) and in nits
    if (cameraData.isHDROutputActive &amp;&amp; cameraData.postProcessEnabled)
    {

    }
    else
    {
        // If HDR output is disabled, disable HDR output-related keywords
        // If post processing is disabled, the final pass will do the color conversion so there is
        // no need to account for HDR Output
        material.DisableKeyword(HDROutputUtils.ShaderKeywords.HDR_INPUT);
    }
}
</code></pre>
</li>
<li>
<p>Create variables to retrieve and store the luminance information from the display as shown below.</p>

<pre><code class="lang-cs">if (cameraData.isHDROutputActive &amp;&amp; cameraData.postProcessEnabled)
{
    // Get luminance information from the display, these define the dynamic range of the display.
    float minNits = cameraData.hdrDisplayInformation.minToneMapLuminance;
    float maxNits = cameraData.hdrDisplayInformation.maxToneMapLuminance;
    float paperWhite = cameraData.hdrDisplayInformation.paperWhiteNits;
}
else
{
    // If HDR output is disabled, disable HDR output-related keywords
    // If post processing is disabled, the final pass will do the color conversion so there is
    // no need to account for HDR Output
    material.DisableKeyword(HDROutputUtils.ShaderKeywords.HDR_INPUT);
}
</code></pre>
</li>
<li>
<p>Retrieve the <span class="tooltip"><strong>tonemapping</strong><span class="tooltiptext">The process of remapping HDR values of an image into a range suitable to be displayed on screen. <a class="tooltipMoreInfoLink" href="../../PostProcessingOverview.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="../../Glossary.html#Tonemapping">Glossary</a></span></span></span> component from the Volume Manager.</p>

<pre><code class="lang-cs">if (cameraData.isHDROutputActive &amp;&amp; cameraData.postProcessEnabled)
{
    var tonemapping = VolumeManager.instance.stack.GetComponent&lt;Tonemapping&gt;();

    // Get luminance information from the display, these define the dynamic range of the display.
    float minNits = cameraData.hdrDisplayInformation.minToneMapLuminance;
    float maxNits = cameraData.hdrDisplayInformation.maxToneMapLuminance;
    float paperWhite = cameraData.hdrDisplayInformation.paperWhiteNits;
}
</code></pre>
</li>
<li>
<p>Add another <code>if</code> statement to check whether a tonemapping component is present. If a tonemapping component is found, this can override the luminance data from the display.</p>

<pre><code class="lang-cs">if (cameraData.isHDROutputActive &amp;&amp; cameraData.postProcessEnabled)
{
    var tonemapping = VolumeManager.instance.stack.GetComponent&lt;Tonemapping&gt;();

    // Get luminance information from the display, these define the dynamic range of the display.
    float minNits = cameraData.hdrDisplayInformation.minToneMapLuminance;
    float maxNits = cameraData.hdrDisplayInformation.maxToneMapLuminance;
    float paperWhite = cameraData.hdrDisplayInformation.paperWhiteNits;

    if (tonemapping != null)
    {
        // Tone mapping post process can override the luminance retrieved from the display
        if (!tonemapping.detectPaperWhite.value)
        {
            paperWhite = tonemapping.paperWhite.value;
        }
        if (!tonemapping.detectBrightnessLimits.value)
        {
            minNits = tonemapping.minNits.value;
            maxNits = tonemapping.maxNits.value;
        }
    }
}
</code></pre>
</li>
<li>
<p>Set the luminance properties of the material with the luminance data from the display and tonemapping.</p>

<pre><code class="lang-cs">if (cameraData.isHDROutputActive &amp;&amp; cameraData.postProcessEnabled)
{
    var tonemapping = VolumeManager.instance.stack.GetComponent&lt;Tonemapping&gt;();

    // Get luminance information from the display, these define the dynamic range of the display.
    float minNits = cameraData.hdrDisplayInformation.minToneMapLuminance;
    float maxNits = cameraData.hdrDisplayInformation.maxToneMapLuminance;
    float paperWhite = cameraData.hdrDisplayInformation.paperWhiteNits;

    if (tonemapping != null)
    {
        // Tone mapping post process can override the luminance retrieved from the display
        if (!tonemapping.detectPaperWhite.value)
        {
            paperWhite = tonemapping.paperWhite.value;
        }
        if (!tonemapping.detectBrightnessLimits.value)
        {
            minNits = tonemapping.minNits.value;
            maxNits = tonemapping.maxNits.value;
        }
    }

    // Pass luminance data to the material, use these to interpret the range of values the
    // input will be in.
    material.SetFloat(&quot;_MinNits&quot;, minNits);
    material.SetFloat(&quot;_MaxNits&quot;, maxNits);
    material.SetFloat(&quot;_PaperWhite&quot;, paperWhite);
}
</code></pre>
</li>
<li>
<p>Retrieve the color gamut of the current color space and pass it to the material.</p>

<pre><code class="lang-cs">// Pass luminance data to the material, use these to interpret the range of values the
// input will be in.
material.SetFloat(&quot;_MinNits&quot;, minNits);
material.SetFloat(&quot;_MaxNits&quot;, maxNits);
material.SetFloat(&quot;_PaperWhite&quot;, paperWhite);

// Pass the color gamut data to the material (colorspace and transfer function).
HDROutputUtils.GetColorSpaceForGamut(cameraData.hdrDisplayColorGamut, out int colorspaceValue);
material.SetInteger(&quot;_HDRColorspace&quot;, colorspaceValue);
</code></pre>
</li>
<li>
<p>Enable the HDR Output shader keywords.</p>

<pre><code class="lang-cs">// Pass the color gamut data to the material (colorspace and transfer function).
HDROutputUtils.GetColorSpaceForGamut(cameraData.hdrDisplayColorGamut, out int colorspaceValue);
material.SetInteger(&quot;_HDRColorspace&quot;, colorspaceValue);

// Enable HDR shader keywords
material.EnableKeyword(HDROutputUtils.ShaderKeywords.HDR_INPUT);
</code></pre>
</li>
<li><p>Call the SetupHDROutput method in your Execute() function to ensure that HDR Output is accounted for whenever this Scriptable Render Pass is in use.</p></li>
</ol>

<h2>Complete Script Example</h2>

<p>The following is the complete code from the example:</p>

<pre><code class="lang-cs">class CustomFullScreenRenderPass : ScriptableRenderPass
{
    // Leave your existing Render Pass code here

    static void SetupHDROutput(ref CameraData cameraData, Material material)
    {
        // If post processing is enabled, color grading has already applied tone mapping
        // As a result the input here will be in the display colorspace (Rec2020, P3, etc) and in nits
        if (cameraData.isHDROutputActive &amp;&amp; cameraData.postProcessEnabled)
        {
            var tonemapping = VolumeManager.instance.stack.GetComponent&lt;Tonemapping&gt;();

            // Get luminance information from the display, these define the dynamic range of the display.
            float minNits = cameraData.hdrDisplayInformation.minToneMapLuminance;
            float maxNits = cameraData.hdrDisplayInformation.maxToneMapLuminance;
            float paperWhite = cameraData.hdrDisplayInformation.paperWhiteNits;

            if (tonemapping != null)
            {
                // Tone mapping post process can override the luminance retrieved from the display
                if (!tonemapping.detectPaperWhite.value)
                {
                    paperWhite = tonemapping.paperWhite.value;
                }
                if (!tonemapping.detectBrightnessLimits.value)
                {
                    minNits = tonemapping.minNits.value;
                    maxNits = tonemapping.maxNits.value;
                }
            }

            // Pass luminance data to the material, use these to interpret the range of values the
            // input will be in.
            material.SetFloat(&quot;_MinNits&quot;, minNits);
            material.SetFloat(&quot;_MaxNits&quot;, maxNits);
            material.SetFloat(&quot;_PaperWhite&quot;, paperWhite);

            // Pass the color gamut data to the material (colorspace and transfer function).
            HDROutputUtils.GetColorSpaceForGamut(cameraData.hdrDisplayColorGamut, out int colorspaceValue);
            material.SetInteger(&quot;_HDRColorspace&quot;, colorspaceValue);

            // Enable HDR shader keywords
            material.EnableKeyword(HDROutputUtils.ShaderKeywords.HDR_INPUT);
        }
        else
        {
            // If HDR output is disabled, disable HDR output-related keywords
            // If post processing is disabled, the final pass will do the color conversion so there is
            // no need to account for HDR Output
            material.DisableKeyword(HDROutputUtils.ShaderKeywords.HDR_INPUT);
        }
    }
}
</code></pre>
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a aria-label="go to the previous page" href="../../urp/post-processing/hdr-output-implement-custom-overlay.html"></a></span><div class="tip">Implement an HDR Output compatible custom overlay in URP</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a aria-label="go to the next page" href="../../class-ShaderImporter.html"></a></span><div class="tip">Shader Import Settings window reference</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright ©2005-2025 Unity Technologies. All rights reserved. Built from 6000.2.5f1 (6de28e1118ee). Built on: 2025-09-05.</div>
<div class="menu">
<a href="https://learn.unity.com/">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a><a href="https://docs.unity3d.com/Manual/TermsOfUse.html">Terms of use</a><a href="https://unity.com/legal">Legal</a><a href="https://unity.com/legal/privacy-policy">Privacy Policy</a><a href="https://unity.com/legal/cookie-policy">Cookies</a><a href="https://unity.com/legal/do-not-sell-my-personal-information">Do Not Sell or Share My Personal Information</a><div id="ot-sdk-btn-container"><a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a></div>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
